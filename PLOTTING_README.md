# Function Plotting Test Scripts

This directory contains comprehensive test scripts for reading generated binary files from the data generator and creating visualizations using matplotlib.

## Scripts Overview

### 1. `plot_functions.py` - Enhanced Function Plotter
The main script for creating detailed plots of function outputs from binary data files.

**Features:**
- Reads binary files generated by `generate_test_data.py`
- Creates individual plots for each function type
- Generates an overview plot showing all functions together
- Saves plots as PNG files (works in headless environments)
- Supports different bit widths (8, 16, 32 bits)
- Adds function-specific annotations (peaks, valleys, transitions)

**Usage:**
```bash
python3 plot_functions.py <definition_file> <binary_file> <count> [--bits {8,16,32}] [--output-dir OUTPUT_DIR]
```

**Example:**
```bash
python3 plot_functions.py graph_def.txt test_graph_output.bin 100 --output-dir my_plots
```

### 2. `plot_test_data.py` - Data Analysis and Visualization
Comprehensive data analysis script that provides detailed statistics and visualizations.

**Features:**
- Detailed statistical analysis of all fields
- Identifies function vs. constant fields
- Creates comprehensive plots with statistics
- Works with both interactive and non-interactive matplotlib backends

**Usage:**
```bash
python3 plot_test_data.py <definition_file> <binary_file> <count> [--bits {8,16,32}]
```

### 3. `simple_test_demo.py` - Complete Demonstration
An all-in-one demonstration script that shows the complete workflow.

**Features:**
- Creates a demonstration definition file
- Generates test data with various function types
- Creates visualizations
- Runs complete analysis
- Provides clear output documentation

**Usage:**
```bash
python3 simple_test_demo.py
```

## Supported Function Types

The plotting scripts can visualize all function types supported by the data generator:

1. **Sine Wave** (`<sine min max [period]>`)
   - Smooth sinusoidal oscillation
   - Optional period parameter controls wave frequency (default: 20)
   - Annotations: Peaks and valleys marked

2. **Square Wave** (`<square min max [period]>`)
   - Sharp transitions between two levels
   - Optional period parameter controls wave frequency (default: 20)
   - Annotations: Transition points marked

3. **Triangle Wave** (`<triangle min max [period]>`)
   - Linear ramps up and down
   - Optional period parameter controls wave frequency (default: 40)
   - Smooth triangular pattern

4. **Sawtooth Wave** (`<sawtooth min max [period]>`)
   - Linear ramp that resets periodically
   - Optional period parameter controls wave frequency (default: 30)
   - Creates a saw-tooth pattern

5. **Random Values** (`<random min max>`)
   - Pseudo-random values within specified range
   - Statistical distribution visualization

6. **QRS Complex** (`<qrs q_val q_samples r_val r_period s_val s_samples [overall_period]>`)
   - Simulated ECG QRS complex pattern
   - Optional overall_period parameter controls overall cycle period (default: r_period)
   - Annotations: R-peaks marked

7. **Checksum** (`<checksum>`)
   - Sum of all other bytes in the current sample
   - Useful for data integrity validation

8. **Inverse Checksum** (`<inverse_checksum>`)
   - Negative of the sum of all other bytes in current sample
   - Calculated as -(sum of all other fields)
   - Commonly used for error detection protocols

## Generated Files

### Plot Types
- **Individual Function Plots**: Separate PNG file for each function type
- **Functions Overview**: Combined plot showing all functions together
- **Statistical Analysis**: Text-based analysis with mean, std, min, max values

### File Naming Convention
- `<function_name>_function.png` - Individual function plots
- `functions_overview.png` - Combined overview plot
- Organized in specified output directories

## Dependencies

Required Python packages:
- `matplotlib` - For plotting and visualization
- `numpy` - For numerical operations and data handling
- Standard library modules: `argparse`, `struct`, `sys`, `os`, `re`

### Installation (Debian/Ubuntu)
```bash
sudo apt update
sudo apt install python3-matplotlib python3-numpy
```

### Installation (pip)
```bash
pip3 install matplotlib numpy
```

## Usage Examples

### Basic Function Plotting
```bash
# Generate test data
python3 generate_test_data.py graph_def.txt test_output.bin 100

# Create function plots
python3 plot_functions.py graph_def.txt test_output.bin 100 --output-dir plots

# Run detailed analysis
python3 plot_test_data.py graph_def.txt test_output.bin 100
```

### Working with Different Bit Widths
```bash
# Generate 16-bit data
python3 generate_test_data.py test_def.txt output_16bit.bin 50 --bits 16

# Plot 16-bit data
python3 plot_functions.py test_def.txt output_16bit.bin 50 --bits 16
```

### Quick Demo
```bash
# Run complete demonstration
python3 simple_test_demo.py
```

## Definition File Format

The scripts work with definition files that specify the data structure:

```
# Comments start with #
0x80                    # Hexadecimal constant
100                     # Decimal constant
-50                     # Negative decimal constant
<random 0 255>          # Random function with range
<sine -100 100 25>      # Sine wave with amplitude range and period
<square 10 200 15>      # Square wave with value range and period
<triangle 0 150 30>     # Triangle wave with range and period
<sawtooth 20 80 20>     # Sawtooth wave with range and period
<qrs -100 2 1000 16 -150 2 20>  # QRS complex with overall period
```

## Output Structure

After running the scripts, you'll have:

```
your_workspace/
├── plots/                      # Plot output directory
│   ├── functions_overview.png  # Combined overview
│   ├── sine_function.png       # Individual function plots
│   ├── square_function.png
│   ├── triangle_function.png
│   └── ...
├── demo_plots/                 # Demo output directory
└── binary_files.bin           # Generated binary data
```

## Troubleshooting

### Common Issues

1. **ModuleNotFoundError: No module named 'matplotlib'**
   - Install matplotlib using system package manager or pip
   - See Dependencies section above

2. **File size mismatch warnings**
   - The scripts automatically adjust for actual file size
   - Verify your definition file matches the generated data

3. **No plots displayed**
   - Scripts use non-interactive backend for headless environments
   - Check the output directory for saved PNG files

4. **Permission errors**
   - Ensure write permissions for output directories
   - Scripts automatically create directories as needed

## Features and Capabilities

### Advanced Plot Features
- **Statistical annotations**: Mean, standard deviation, min/max values
- **Function-specific annotations**: Peaks, valleys, transitions, patterns
- **Color-coded functions**: Each function type has a distinct color
- **Grid and labels**: Professional-looking plots with proper labeling
- **Flexible output**: Saves plots as high-resolution PNG files

### Data Analysis
- **Automatic field identification**: Distinguishes between constants and functions
- **Statistical analysis**: Comprehensive statistics for each field
- **Data validation**: Checks file sizes and data integrity
- **Flexible bit width support**: Works with 8, 16, and 32-bit data

### Extensibility
The scripts are designed to be easily extensible:
- Add new function types by modifying the color scheme and annotations
- Customize plot appearance by adjusting matplotlib parameters
- Add new analysis features by extending the data processing functions

## Integration with Data Generator

These plotting scripts are designed to work seamlessly with the `generate_test_data.py` script:

1. Use the same definition file for both generation and plotting
2. Specify the same bit width and sample count
3. The plotting scripts automatically handle the binary data format
4. Function outputs are correctly identified and visualized

This ensures complete compatibility and accurate visualization of all generated data.
